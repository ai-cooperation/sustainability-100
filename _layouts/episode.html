---
layout: default
---
<article class="episode-detail">
  <div class="episode-header">
    <a href="{{ '/' | relative_url }}" class="back-link">&larr; å›é¦–é </a>
    <span class="series-badge">{{ page.series }} {{ page.series_name }}</span>
    <h1>{{ page.ep_id }}ï½œ{{ page.title }}</h1>
    <p class="outline">{{ page.outline }}</p>
    <time>{{ page.date | date: "%Y-%m-%d" }}</time>
  </div>

  <!-- â”€â”€ English Podcast â”€â”€ -->
  {% assign en_audio = page.podcast_en | default: page.podcast_audio %}
  {% if en_audio %}
  <section class="podcast-section">
    <h2>ğŸ§ Podcast (English)</h2>
    <div class="podcast-player" data-lang="en">
      <audio class="podcast-audio" preload="metadata">
        <source src="{{ '/assets/audio/' | append: page.ep_id | append: '/' | append: en_audio | relative_url }}" type="audio/mp4">
      </audio>
      <div class="player-controls">
        <button class="play-btn" aria-label="Play">
          <svg class="icon-play" viewBox="0 0 24 24" width="28" height="28">
            <polygon points="6,3 20,12 6,21" fill="currentColor"/>
          </svg>
          <svg class="icon-pause" viewBox="0 0 24 24" width="28" height="28" style="display:none">
            <rect x="5" y="3" width="4" height="18" fill="currentColor"/>
            <rect x="15" y="3" width="4" height="18" fill="currentColor"/>
          </svg>
        </button>
        <div class="player-info">
          <div class="player-title">{{ page.podcast_en_title | default: page.title }}</div>
          <div class="player-progress">
            <div class="progress-track">
              <div class="progress-played"></div>
            </div>
            <div class="time-row">
              <span class="time-current">0:00</span>
              <span class="time-total">0:00</span>
            </div>
          </div>
        </div>
        <button class="speed-btn">1x</button>
      </div>
    </div>
    {% if page.transcript_en %}
    <div class="transcript-download">
      <a href="{{ '/assets/audio/' | append: page.ep_id | append: '/' | append: page.transcript_en | relative_url }}" download class="download-btn">
        <svg viewBox="0 0 20 20" width="16" height="16" fill="currentColor"><path d="M10 13l-4-4h3V3h2v6h3l-4 4zm-6 2h12v2H4v-2z"/></svg>
        Download Transcript (EN)
      </a>
    </div>
    {% endif %}
  </section>
  {% endif %}

  <!-- â”€â”€ Chinese Podcast â”€â”€ -->
  {% if page.podcast_zh %}
  <section class="podcast-section">
    <h2>ğŸ§ Podcastï¼ˆä¸­æ–‡ï¼‰</h2>
    <div class="podcast-player" data-lang="zh">
      <audio class="podcast-audio" preload="metadata">
        <source src="{{ '/assets/audio/' | append: page.ep_id | append: '/' | append: page.podcast_zh | relative_url }}" type="audio/mp4">
      </audio>
      <div class="player-controls">
        <button class="play-btn" aria-label="æ’­æ”¾">
          <svg class="icon-play" viewBox="0 0 24 24" width="28" height="28">
            <polygon points="6,3 20,12 6,21" fill="currentColor"/>
          </svg>
          <svg class="icon-pause" viewBox="0 0 24 24" width="28" height="28" style="display:none">
            <rect x="5" y="3" width="4" height="18" fill="currentColor"/>
            <rect x="15" y="3" width="4" height="18" fill="currentColor"/>
          </svg>
        </button>
        <div class="player-info">
          <div class="player-title">{{ page.podcast_zh_title | default: page.title }}</div>
          <div class="player-progress">
            <div class="progress-track">
              <div class="progress-played"></div>
            </div>
            <div class="time-row">
              <span class="time-current">0:00</span>
              <span class="time-total">0:00</span>
            </div>
          </div>
        </div>
        <button class="speed-btn">1x</button>
      </div>
    </div>
    {% if page.transcript_zh %}
    <div class="transcript-download">
      <a href="{{ '/assets/audio/' | append: page.ep_id | append: '/' | append: page.transcript_zh | relative_url }}" download class="download-btn">
        <svg viewBox="0 0 20 20" width="16" height="16" fill="currentColor"><path d="M10 13l-4-4h3V3h2v6h3l-4 4zm-6 2h12v2H4v-2z"/></svg>
        ä¸‹è¼‰é€å­—ç¨¿ (ä¸­æ–‡)
      </a>
    </div>
    {% endif %}
  </section>
  {% endif %}

  <!-- â”€â”€ Video â”€â”€ -->
  {% if page.video_file %}
  <section class="video-section">
    <h2>ğŸ¬ å½±ç‰‡</h2>
    <div class="video-wrapper">
      <video controls preload="metadata" playsinline>
        <source src="{{ '/assets/video/' | append: page.ep_id | append: '/' | append: page.video_file | relative_url }}" type="video/mp4">
        æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å½±ç‰‡æ’­æ”¾
      </video>
    </div>
  </section>
  {% endif %}

  <!-- â”€â”€ Podcast Player JavaScript (class-based, multi-player) â”€â”€ -->
  {% assign en_audio = page.podcast_en | default: page.podcast_audio %}
  {% if en_audio or page.podcast_zh %}
  <script>
  (function() {
    var players = document.querySelectorAll('.podcast-player');
    var allAudios = [];
    var speeds = [1, 1.25, 1.5, 2];

    function fmt(s) {
      var m = Math.floor(s / 60);
      var sec = Math.floor(s % 60);
      return m + ':' + (sec < 10 ? '0' : '') + sec;
    }

    players.forEach(function(player) {
      var audio = player.querySelector('.podcast-audio');
      var playBtn = player.querySelector('.play-btn');
      var iconPlay = playBtn.querySelector('.icon-play');
      var iconPause = playBtn.querySelector('.icon-pause');
      var progressBar = player.querySelector('.progress-played');
      var progressTrack = player.querySelector('.progress-track');
      var timeCurrent = player.querySelector('.time-current');
      var timeTotal = player.querySelector('.time-total');
      var speedBtn = player.querySelector('.speed-btn');
      var speedIdx = 0;

      allAudios.push({ audio: audio, iconPlay: iconPlay, iconPause: iconPause });

      playBtn.onclick = function() {
        if (audio.paused) {
          // Pause all other players first
          allAudios.forEach(function(item) {
            if (item.audio !== audio && !item.audio.paused) {
              item.audio.pause();
              item.iconPlay.style.display = 'block';
              item.iconPause.style.display = 'none';
            }
          });
          audio.play();
          iconPlay.style.display = 'none';
          iconPause.style.display = 'block';
        } else {
          audio.pause();
          iconPlay.style.display = 'block';
          iconPause.style.display = 'none';
        }
      };

      audio.addEventListener('loadedmetadata', function() {
        timeTotal.textContent = fmt(audio.duration);
      });

      audio.addEventListener('timeupdate', function() {
        if (audio.duration) {
          progressBar.style.width = (audio.currentTime / audio.duration * 100) + '%';
          timeCurrent.textContent = fmt(audio.currentTime);
        }
      });

      audio.addEventListener('ended', function() {
        iconPlay.style.display = 'block';
        iconPause.style.display = 'none';
      });

      progressTrack.onclick = function(e) {
        var rect = progressTrack.getBoundingClientRect();
        var pct = (e.clientX - rect.left) / rect.width;
        audio.currentTime = pct * audio.duration;
      };

      speedBtn.onclick = function() {
        speedIdx = (speedIdx + 1) % speeds.length;
        audio.playbackRate = speeds[speedIdx];
        speedBtn.textContent = speeds[speedIdx] + 'x';
      };
    });
  })();
  </script>
  {% endif %}

  {% if page.slides and page.slides.size > 0 %}
  <section class="slides-section">
    <h2>ç°¡å ±åœ–å¡</h2>
    <div class="slides-grid">
      {% for slide in page.slides %}
      <div class="slide-card">
        {% if slide.image and slide.image != "" %}
        <img src="{{ '/assets/images/' | append: page.ep_id | append: '/' | append: slide.image | relative_url }}"
             alt="{{ slide.title }}" loading="lazy">
        {% endif %}
        <h3>{{ slide.title }}</h3>
        <ul>
          {% for point in slide.points %}
          <li>{{ point }}</li>
          {% endfor %}
        </ul>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <section class="research-content">
    <h2>ç ”ç©¶å ±å‘Š</h2>
    {{ content }}
  </section>

  <nav class="episode-nav">
    {% assign sorted = site.episodes | sort: "number" %}
    {% for ep in sorted %}
      {% if ep.number == page.number %}
        {% assign idx = forloop.index0 %}
      {% endif %}
    {% endfor %}
    {% assign prev_idx = idx | minus: 1 %}
    {% assign next_idx = idx | plus: 1 %}
    {% if prev_idx >= 0 %}
      <a href="{{ sorted[prev_idx].url | relative_url }}" class="nav-prev">&larr; {{ sorted[prev_idx].ep_id }}</a>
    {% endif %}
    {% if next_idx < sorted.size %}
      <a href="{{ sorted[next_idx].url | relative_url }}" class="nav-next">{{ sorted[next_idx].ep_id }} &rarr;</a>
    {% endif %}
  </nav>
</article>
